<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üñºÔ∏è Image Compressor with Bulk Download</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Theme Variables */
:root {
  /* Light Theme */
  --light-primary: #7c3aed;
  --light-primary-dark: #6d28d9;
  --light-primary-light: #a78bfa;
  --light-background: #ffffff;
  --light-background-secondary: #f3f4f6;
  --light-text: #1f2937;
  --light-text-secondary: #4b5563;
  --light-border: #e5e7eb;
  --light-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  
  /* Dark Theme */
  --dark-primary: #7c3aed;
  --dark-primary-dark: #6d28d9;
  --dark-primary-light: #a78bfa;
  --dark-background: #1f2937;
  --dark-background-secondary: #111827;
  --dark-text: #f9fafb;
  --dark-text-secondary: #d1d5db;
  --dark-border: #374151;
  --dark-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);

  /* Common Variables */
  --border-radius-sm: 0.375rem;
  --border-radius-md: 0.5rem;
  --border-radius-lg: 0.75rem;
  --border-radius-xl: 1rem;
  --transition-base: all 0.3s ease;
}

/* Dark Theme (Default) */
:root {
  --primary-color: var(--dark-primary);
  --primary-dark: var(--dark-primary-dark);
  --primary-light: var(--dark-primary-light);
  --background-start: #312e81;
  --background-end: #6d28d9;
  --text-color: var(--dark-text);
  --text-color-secondary: var(--dark-text-secondary);
  --background-color: var(--dark-background);
  --background-color-secondary: var(--dark-background-secondary);
  --border-color: var(--dark-border);
  --shadow-color: var(--dark-shadow);
}

/* Light Theme */
[data-theme="light"] {
  --primary-color: var(--light-primary);
  --primary-dark: var(--light-primary-dark);
  --primary-light: var(--light-primary-light);
  --background-start: #e0e7ff;
  --background-end: #c4b5fd;
  --text-color: var(--light-text);
  --text-color-secondary: var(--light-text-secondary);
  --background-color: var(--light-background);
  --background-color-secondary: var(--light-background-secondary);
  --border-color: var(--light-border);
  --shadow-color: var(--dark-shadow);
}

/* Theme Toggle Button */
.theme-toggle {
  position: fixed;
  top: 1rem;
  right: 1rem;
  background: var(--background-color-secondary);
  border: 2px solid var(--primary-color);
  color: var(--text-color);
  padding: 0.5rem;
  border-radius: 50%;
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: var(--transition-base);
  z-index: 1000;
  box-shadow: var(--shadow-color);
}

.theme-toggle:hover {
  transform: scale(1.1);
  background: var(--primary-color);
  color: white;
}

/* Update existing styles to use theme variables */
body {
  background: linear-gradient(135deg, var(--background-start) 0%, var(--background-end) 100%);
  color: var(--text-color);
}

.blackbox {
  background-color: var(--background-color);
  box-shadow: var(--shadow-color);
}

.fancy-btn {
  background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
  color: white;
  font-weight: 600;
  text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.filter-btn {
  background: var(--background-color-secondary);
  color: var(--text-color);
  border: 1px solid var(--primary-color);
  font-weight: 500;
}

.filter-btn:hover {
  background: var(--primary-color);
  color: white;
}

input[type="number"],
select {
  background: var(--background-color-secondary);
  color: var(--text-color);
  border: 1px solid var(--border-color);
  font-weight: 500;
}

input[type="range"] {
  background: var(--background-color-secondary);
}

input[type="range"]::-webkit-slider-thumb {
  background: var(--primary-color);
  border: 2px solid var(--background-color);
}

.preview-label {
  color: var(--text-color);
  font-weight: 500;
}

.filter-instruction {
  color: var(--text-color);
  font-weight: 500;
}

.bulk-list {
  display: none; /* Hide by default */
  color: var(--text-color);
  font-weight: 500;
  margin: 1rem 0;
  padding: 1rem;
  background: var(--background-color-secondary);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--border-color);
  max-height: 200px;
  overflow-y: auto;
}

.bulk-list:not(:empty) {
  display: block; /* Show only when it has content */
}

.bulk-list span {
  display: inline-block;
  position: relative;
  margin: 0 8px 8px 0;
  transition: var(--transition-base);
}

.bulk-list span:hover {
  transform: translateY(-2px);
}

.bulk-list img {
  width: 60px;
  height: 60px;
  object-fit: cover;
  border-radius: 8px;
  border: 2px solid var(--primary-color);
  box-shadow: var(--shadow-color);
  vertical-align: middle;
  transition: var(--transition-base);
}

.bulk-list img:hover {
  border-color: var(--primary-light);
  box-shadow: 0 4px 12px rgba(124, 58, 237, 0.3);
}

.bulk-list button {
  position: absolute;
  top: -8px;
  right: -8px;
  background: var(--primary-color);
  border: none;
  border-radius: 50%;
  width: 22px;
  height: 22px;
  color: white;
  font-weight: bold;
  cursor: pointer;
  box-shadow: var(--shadow-color);
  transition: var(--transition-base);
  opacity: 0;
  transform: scale(0.8);
}

.bulk-list span:hover button {
  opacity: 1;
  transform: scale(1);
}

.bulk-list button:hover {
  transform: scale(1.1);
  background: var(--primary-dark);
}

.bulk-list div {
  font-size: 11px;
  color: var(--text-color);
  text-align: center;
  max-width: 60px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  margin-top: 4px;
  transition: var(--transition-base);
}

/* Scrollbar styling for bulk list */
.bulk-list::-webkit-scrollbar {
  width: 8px;
  height: 8px;
}

.bulk-list::-webkit-scrollbar-track {
  background: var(--background-color);
  border-radius: 4px;
}

.bulk-list::-webkit-scrollbar-thumb {
  background: var(--primary-color);
  border-radius: 4px;
}

.bulk-list::-webkit-scrollbar-thumb:hover {
  background: var(--primary-dark);
}

/* Reset and base styles */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html, body {
  height: 100%;
  min-height: 100%;
  margin: 0;
  padding: 0;
  font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
  line-height: 1.5;
}

body {
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  background: linear-gradient(135deg, var(--background-start) 0%, var(--background-end) 100%);
  color: var(--text-color);
  padding: 0;
}

/* Layout */
.main-wrapper {
  flex: 1 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 0;
  min-width: 0;
  padding: 1rem;
  width: 100%;
}

.max-w-5xl {
  width: 100%;
  max-width: 48rem;
  margin: 0 auto;
}

.blackbox {
  background-color: var(--background-color);
  border-radius: var(--border-radius-xl);
  box-shadow: var(--shadow-color);
  padding: 1.5rem;
  width: 100%;
  height: auto;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

/* Typography */
.main-heading {
  text-align: center;
  font-weight: bold;
  margin-bottom: 1.5rem;
  animation: pulse 2s infinite;
  padding: 0 1rem;
  word-break: break-word;
  line-height: 1.3;
  max-width: 95%;
  margin-left: auto;
  margin-right: auto;
  font-size: clamp(1.5rem, 5vw, 2.5rem);
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

/* Drop Zone */
.drop-zone {
  background: var(--background-color-secondary);
  border: 2px dashed var(--primary-color);
  color: var(--text-color);
  font-weight: 500;
  padding: clamp(1rem, 5vw, 2.5rem);
  border-radius: var(--border-radius-lg);
  cursor: pointer;
  text-align: center;
  font-size: clamp(0.9rem, 2vw, 1.1rem);
  transition: var(--transition-base);
  min-height: 200px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 1rem 0;
  position: relative;
  overflow: hidden;
}

.drop-zone:hover {
  transform: scale(1.02);
  box-shadow: 0 0 20px var(--primary-light);
  border-color: var(--primary-light);
}

.drop-zone.dragover {
  background: var(--primary-light);
  border-color: var(--primary-color);
  color: white;
  animation: none;
}

/* Buttons */
.fancy-btn {
  background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
  color: white;
  padding: 0.75rem 1.5rem;
  border-radius: var(--border-radius-lg);
  border: none;
  cursor: pointer;
  font-weight: 600;
  font-size: 1rem;
  box-shadow: 0 0 20px rgba(147, 51, 234, 0.3);
  transition: var(--transition-base);
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
}

.fancy-btn:hover {
  background: linear-gradient(90deg, var(--primary-light), var(--primary-color));
  box-shadow: 0 0 30px rgba(192, 132, 252, 0.4);
  transform: translateY(-2px);
}

.file-btn {
  color: var(--primary-color);
  font-weight: 600;
  text-decoration: underline;
  cursor: pointer;
}

.file-btn:hover {
  color: var(--primary-dark);
}

/* Preview Container */
.preview-container {
  background: var(--background-color-secondary);
  border: 1px solid var(--border-color);
  border-radius: var(--border-radius-lg);
  padding: 1rem;
  margin: 1rem 0;
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 1.5rem;
  width: 100%;
}

.preview-label {
  text-align: center;
  font-size: 0.9rem;
  color: var(--text-color);
  margin-bottom: 0.75rem;
  font-weight: 500;
}

/* Filters */
.filter-container {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
  justify-content: center;
  margin: 1.5rem 0;
  padding: 0 1rem;
}

.filter-btn {
  background: var(--background-color-secondary);
  color: var(--text-color);
  padding: 0.75rem 1.25rem;
  border-radius: var(--border-radius-md);
  cursor: pointer;
  transition: var(--transition-base);
  border: 1px solid var(--primary-color);
  font-size: 0.9rem;
  min-width: 100px;
}

.filter-btn:hover {
  background: var(--primary-color);
  transform: translateY(-2px);
}

.filter-btn.active {
  background: var(--primary-color);
  box-shadow: 0 0 10px var(--primary-light);
}

/* Sliders and Controls */
.filter-slider-container {
  display: flex;
  align-items: center;
  gap: 1rem;
  justify-content: center;
  margin: 1rem 0;
  padding: 0 1rem;
  flex-wrap: wrap;
}

input[type="range"] {
  width: 100%;
  max-width: 300px;
  height: 6px;
  background: var(--background-color-secondary);
  border-radius: 3px;
  outline: none;
  -webkit-appearance: none;
}

input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px;
  height: 18px;
  background: var(--primary-color);
  border-radius: 50%;
  cursor: pointer;
  transition: var(--transition-base);
}

input[type="range"]::-webkit-slider-thumb:hover {
  background: var(--primary-light);
  transform: scale(1.1);
}

/* Responsive Design */
@media (max-width: 768px) {
  .blackbox {
    padding: 1rem;
    border-radius: var(--border-radius-lg);
  }

  .preview-container {
    grid-template-columns: 1fr;
  }

  .filter-container {
    gap: 0.5rem;
  }

  .filter-btn {
    padding: 0.5rem 1rem;
    min-width: 80px;
    font-size: 0.85rem;
  }

  .fancy-btn {
    padding: 0.6rem 1.2rem;
    font-size: 0.9rem;
  }
}

@media (max-width: 480px) {
  .main-wrapper {
    padding: 0.5rem;
  }

  .drop-zone {
    padding: 1rem;
    min-height: 150px;
  }

  .filter-slider-container {
    flex-direction: column;
    align-items: stretch;
  }

  input[type="range"] {
    max-width: 100%;
  }
}

/* Animations */
@keyframes pulse {
  0%, 100% {
    transform: scale(1);
  }
  50% {
    transform: scale(1.02);
  }
}

@keyframes subtlePulse {
  0%, 100% {
    box-shadow: 0 0 10px var(--primary-color);
  }
  50% {
    box-shadow: 0 0 30px var(--primary-light);
  }
}

/* Utility Classes */
.flex { display: flex; }
.justify-center { justify-content: center; }
.items-center { align-items: center; }
.gap-4 { gap: 1rem; }
.mb-4 { margin-bottom: 1rem; }
.mb-6 { margin-bottom: 1.5rem; }
.mt-4 { margin-top: 1rem; }
.hidden { display: none; }
.block { display: block; }
.text-center { text-align: center; }
.text-sm { font-size: 0.875rem; }
.text-gray-300 { color: var(--gray-300); }
.text-purple-300 { color: var(--primary-light); }
.text-purple-400 { color: var(--primary-light); }
.font-semibold { font-weight: 600; }
.rounded-xl { border-radius: var(--border-radius-lg); }
.px-4 { padding-left: 1rem; padding-right: 1rem; }
.py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
.px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
.py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
.bg-gray-700 { background-color: var(--gray-700); }
.bg-purple-600 { background-color: var(--primary-color); }
.hover\:bg-purple-600:hover { background-color: var(--primary-color); }
.hover\:bg-gray-700:hover { background-color: var(--gray-700); }
.shadow { box-shadow: var(--shadow-md); }
.transition { transition: var(--transition-base); }

/* Signature */
.signature-container {
  margin-top: 2rem;
  margin-bottom: 1rem;
  text-align: right;
  width: 100%;
  padding: 0 1rem;
}

.signature-text {
  font-family: 'Pacifico', 'Dancing Script', cursive, sans-serif;
  font-size: clamp(1.2rem, 3vw, 2rem);
  color: var(--text-color);
  text-shadow: 2px 2px 8px rgba(0, 0, 0, 0.2);
  letter-spacing: 2px;
  user-select: none;
  display: inline-block;
  padding-right: 0.5rem;
}

.signature-heart {
  color: #ff4d6d;
  font-size: 1.2em;
  vertical-align: middle;
  margin: 0 0.2em;
  animation: heartbeat 1.5s infinite;
}

@keyframes heartbeat {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}

/* Image Preview */
img {
  max-height: 200px;
  border-radius: var(--border-radius-md);
  object-fit: contain;
  width: 100%;
  height: auto;
  box-shadow: var(--shadow-md);
}

/* Form Elements */
input[type="number"],
select {
  width: 100%;
  padding: 0.75rem;
  border-radius: var(--border-radius-md);
  background: var(--background-color-secondary);
  color: var(--text-color);
  border: 1px solid var(--border-color);
  font-size: 1rem;
  transition: var(--transition-base);
}

input[type="number"]:focus,
select:focus {
  outline: none;
  border-color: var(--primary-light);
  box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.2);
}

/* Grid Layout for Advanced Mode */
.grid {
  display: grid;
  gap: 1rem;
}

@media (min-width: 640px) {
  .grid-cols-2 {
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (min-width: 1024px) {
  .grid-cols-3 {
    grid-template-columns: repeat(3, 1fr);
  }
}

/* Loading States */
.loading {
  opacity: 0.7;
  pointer-events: none;
  position: relative;
}

.loading::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 24px;
  height: 24px;
  margin: -12px 0 0 -12px;
  border: 2px solid var(--primary-light);
  border-top-color: transparent;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

@media (max-width: 269px) {
  .max-w-5xl {
    height: 100vh;
  }
}

html, body {
  height: 100%;
  min-height: 100%;
  margin: 0;
  padding: 0;
}

.main-wrapper {
  flex: 1 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 0;
  min-width: 0;
  padding: 1rem;
}

.max-w-5xl {
  width: 100%;
  max-width: 48rem;
}

.bg-gray-800 {
  background-color: #1f2937;
}

.p-6 {
  padding: 1.5rem;
}

.rounded-2xl {
  border-radius: 1rem;
}

.shadow-2xl {
  box-shadow: 0 10px 40px 0 #00000040;
}

img {
  max-height: 200px;
  border-radius: 10px;
}

.drop-zone {
  border: 4px dashed #7c3aed;
  padding: 40px;
  border-radius: 18px;
  cursor: pointer;
  text-align: center;
  font-size: 1.1rem;
  color: #d1d5db;
  background: linear-gradient(to right, #2e1065, #4c1d95);
  transition: transform 0.3s, box-shadow 0.3s, border-color 0.3s;
  animation: subtlePulse 3s infinite;
  height: 26vw;
  align-items: center;
  justify-content: center;
  display: flex;
}

.drop-zone:hover {
  transform: scale(1.02);
  box-shadow: 0 0 20px #a78bfa;
}

.drop-zone.dragover {
  background-color: #4c1d95;
  border-color: #c084fc;
  animation: none;
}

@keyframes subtlePulse {
  0%, 100% {
    box-shadow: 0 0 10px #7c3aed;
  }
  50% {
    box-shadow: 0 0 30px #a78bfa;
  }
}

.file-btn {
  background-color: #9333ea;
  color: white;
  padding: 0.5rem 2rem;
  border-radius: 10px;
  cursor: pointer;
}

.file-btn:hover {
  background-color: #a855f7;
}

input[type="file"] {
  display: none;
}

.fancy-btn {
  background: linear-gradient(90deg, #7c3aed, #a855f7);
  box-shadow: 0 0 20px #9333ea;
  transition: all 0.3s;
}

.fancy-btn:hover {
  background: linear-gradient(90deg, #a855f7, #9333ea);
  box-shadow: 0 0 30px #c084fc;
  transform: scale(1.05);
}

.preview-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 1rem;
  margin-top: 1rem;
}

.preview-label {
  text-align: center;
  font-size: 0.9rem;
  color: #a78bfa;
  margin-bottom: 0.5rem;
}

.filter-btn {
  background: #4c1d95;
  color: white;
  padding: 0.5rem 1rem;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s;
  border: 1px solid #7c3aed;
}

.filter-btn:hover {
  background: #7c3aed;
  transform: translateY(-2px);
}

.filter-btn.active {
  background: #7c3aed;
  box-shadow: 0 0 10px #a78bfa;
}

.filter-container {
  display: flex;
  gap: 0.5rem;
  flex-wrap: wrap;
  justify-content: center;
  margin: 1rem 0;
}

.filter-instruction {
  text-align: center;
  font-size: 0.9rem;
  color: #a78bfa;
  margin-bottom: 0.5rem;
}

.filter-slider-container {
  display: flex;
  align-items: center;
  gap: 1rem;
  justify-content: center;
  margin-bottom: 1rem;
}

.filter-slider-label {
  color: #a78bfa;
  font-size: 0.95rem;
  min-width: 90px;
  text-align: right;
}

.filter-slider-value {
  color: #c084fc;
  font-weight: bold;
  min-width: 40px;
  text-align: left;
}

.bulk-list {
  color: #a78bfa;
  font-size: 0.95rem;
  margin-bottom: 0.5rem;
}

/* Responsive adjustments */
@media (max-width: 900px) {
  .max-w-5xl {
    max-width: 100%;
  }

  .preview-container {
    grid-template-columns: 1fr;
  }
}

@media (max-width: 640px) {
  .main-wrapper {
    padding: 0.5rem;
  }

  .p-6 {
    padding: 1rem;
  }

  .preview-container {
    grid-template-columns: 1fr;
  }

  .drop-zone {
    padding: 20px;
    font-size: 1rem;
  }
}

.signature-container {
  margin-top: 1.5rem;
  margin-bottom: 0.5rem;
  text-align: right;
  width: 100%;
}

@media (max-width: 640px) {
  .signature-container {
    text-align: center;
    margin-top: 1rem;
  }
}

.main-wrapper > .max-w-5xl {
  margin-bottom: 0;
}

.blackbox {
  height: 100%;
  width: 100vw;
}

.main-heading {
  text-align: center;
  font-weight: bold;
  margin-bottom: 24px;
  animation: pulse 2s infinite;
  padding: 0 1rem;
  word-break: break-word;
  line-height: 1.3;
  max-width: 95%;
  margin-left: auto;
  margin-right: auto;
}

/* Responsive font sizes */
@media (max-width: 639px) {
  .main-heading {
    font-size: 1.5rem;
  }
}

@media (min-width: 640px) {
  .main-heading {
    font-size: 1.75rem;
  }
}

@media (min-width: 768px) {
  .main-heading {
    font-size: 2rem;
  }
}

@media (min-width: 1024px) {
  .main-heading {
    font-size: 2.5rem;
  }
}

/* Additional utility classes */
.flex {
  display: flex;
}

.justify-center {
  justify-content: center;
}

.items-center {
  align-items: center;
}

.gap-4 {
  gap: 1rem;
}

.mb-4 {
  margin-bottom: 1rem;
}

.mb-6 {
  margin-bottom: 1.5rem;
}

.mt-4 {
  margin-top: 1rem;
}

.hidden {
  display: none;
}

.block {
  display: block;
}

.text-center {
  text-align: center;
}

.text-sm {
  font-size: 0.875rem;
}

.text-gray-300 {
  color: #d1d5db;
}

.text-purple-300 {
  color: #d8b4fe;
}

.text-purple-400 {
  color: #c084fc;
}

.font-semibold {
  font-weight: 600;
}

.rounded-xl {
  border-radius: 0.75rem;
}

.px-4 {
  padding-left: 1rem;
  padding-right: 1rem;
}

.py-2 {
  padding-top: 0.5rem;
  padding-bottom: 0.5rem;
}

.px-6 {
  padding-left: 1.5rem;
  padding-right: 1.5rem;
}

.py-3 {
  padding-top: 0.75rem;
  padding-bottom: 0.75rem;
}

.bg-gray-700 {
  background-color: #374151;
}

.bg-purple-600 {
  background-color: #9333ea;
}

.hover\:bg-purple-600:hover {
  background-color: #9333ea;
}

.hover\:bg-gray-700:hover {
  background-color: #374151;
}

.shadow {
  box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
}

.transition {
  transition-property: background-color, border-color, color, fill, stroke, opacity, box-shadow, transform;
  transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
  transition-duration: 150ms;
}

/* Signature styles */
.signature-text {
  font-family: 'Pacifico', 'Dancing Script', cursive, sans-serif;
  font-size: 2rem;
  color: #fff;
  background: none;
  -webkit-background-clip: initial;
  background-clip: initial;
  -webkit-text-fill-color: initial;
  text-shadow: 2px 2px 8px #00000033;
  letter-spacing: 2px;
  user-select: none;
  display: inline-block;
  padding-right: 0.5rem;
}

.signature-highlight {
  color: var(--primary-color);
  font-weight: 600;
}

.signature-heart {
  color: #ff4d6d;
  font-size: 1.2em;
  vertical-align: middle;
  margin: 0 0.2em;
}

@media (max-width: 640px) {
  .signature-text {
    font-size: 1.2rem;
    padding-right: 0.2rem;
  }
}

/* Update text colors for better visibility */
#easyEstimate,
#estimate,
#easyAiMessage,
#aiMessage {
  color: var(--text-color);
  font-weight: 500;
}

#easyEstimate b,
#estimate b {
  color: var(--primary-color);
  font-weight: 600;
}

/* File name display styles */
#fileNameDisplay {
  color: var(--text-color);
  font-weight: 500;
  margin: 1rem 0;
  padding: 0.5rem;
  background: var(--background-color-secondary);
  border-radius: var(--border-radius-md);
  border: 1px solid var(--border-color);
}

#fileName {
  color: var(--primary-color);
  font-weight: 600;
  padding: 0.2rem 0.5rem;
  background: var(--background-color);
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--border-color);
  margin-left: 0.5rem;
}

/* Compression Animation */
.compression-animation {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--background-color);
  padding: 2rem;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-color);
  z-index: 1000;
  text-align: center;
  border: 2px solid var(--primary-color);
}

.compression-animation.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

.compression-spinner {
  width: 50px;
  height: 50px;
  border: 4px solid var(--background-color-secondary);
  border-top: 4px solid var(--primary-color);
  border-radius: 50%;
  margin: 0 auto 1rem;
  animation: spin 1s linear infinite;
}

.compression-text {
  color: var(--text-color);
  font-weight: 500;
  margin-bottom: 0.5rem;
}

.compression-progress {
  width: 200px;
  height: 4px;
  background: var(--background-color-secondary);
  border-radius: 2px;
  margin: 0 auto;
  overflow: hidden;
}

.compression-progress-bar {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
  animation: progress 2s ease-in-out infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

@keyframes progress {
  0% { width: 0%; }
  50% { width: 100%; }
  100% { width: 0%; }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translate(-50%, -60%); }
  to { opacity: 1; transform: translate(-50%, -50%); }
}

/* Add overlay when compressing */
.compression-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  z-index: 999;
}

.compression-overlay.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

/* Download Animation */
.download-animation {
  display: none;
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: var(--background-color);
  padding: 2rem;
  border-radius: var(--border-radius-lg);
  box-shadow: var(--shadow-color);
  z-index: 1000;
  text-align: center;
  border: 2px solid var(--primary-color);
}

.download-animation.active {
  display: block;
  animation: fadeIn 0.3s ease;
}

.download-icon {
  width: 60px;
  height: 60px;
  margin: 0 auto 1rem;
  position: relative;
}

.download-icon::before {
  content: '';
  position: absolute;
  top: 0;
  left: 50%;
  transform: translateX(-50%);
  width: 20px;
  height: 20px;
  border: 4px solid var(--primary-color);
  border-radius: 50%;
  animation: downloadPulse 1.5s ease-in-out infinite;
}

.download-icon::after {
  content: '';
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  width: 4px;
  height: 30px;
  background: var(--primary-color);
  animation: downloadArrow 1.5s ease-in-out infinite;
}

.download-text {
  color: var(--text-color);
  font-weight: 500;
  margin-bottom: 0.5rem;
}

.download-progress {
  width: 200px;
  height: 4px;
  background: var(--background-color-secondary);
  border-radius: 2px;
  margin: 0 auto;
  overflow: hidden;
}

.download-progress-bar {
  width: 0%;
  height: 100%;
  background: linear-gradient(90deg, var(--primary-color), var(--primary-light));
  animation: downloadProgress 2s ease-in-out;
}

@keyframes downloadPulse {
  0% { transform: translateX(-50%) scale(1); opacity: 1; }
  50% { transform: translateX(-50%) scale(1.2); opacity: 0.5; }
  100% { transform: translateX(-50%) scale(1); opacity: 1; }
}

@keyframes downloadArrow {
  0% { transform: translateX(-50%) translateY(0); }
  50% { transform: translateX(-50%) translateY(10px); }
  100% { transform: translateX(-50%) translateY(0); }
}

@keyframes downloadProgress {
  0% { width: 0%; }
  100% { width: 100%; }
}

/* Download overlay */
.download-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
  z-index: 999;
}

.download-overlay.active {
  display: block;
  animation: fadeIn 0.3s ease;
} 
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
  <!-- Theme Toggle Button -->
  <button class="theme-toggle" id="themeToggle" title="Toggle theme">
    üåô
  </button>

  <!-- Compression Animation -->
  <div class="compression-overlay" id="compressionOverlay">
    <div class="compression-animation" id="compressionAnimation">
      <div class="compression-spinner"></div>
      <div class="compression-text">Compressing Image...</div>
      <div class="compression-progress">
        <div class="compression-progress-bar"></div>
      </div>
    </div>
  </div>

  <!-- Download Animation -->
  <div class="download-overlay" id="downloadOverlay">
    <div class="download-animation" id="downloadAnimation">
      <div class="download-icon"></div>
      <div class="download-text">Downloading...</div>
      <div class="download-progress">
        <div class="download-progress-bar"></div>
      </div>
    </div>
  </div>

  <div class="main-wrapper">
    <div class="blackbox">
      <div class="flex justify-start mb-4">
        <button 
          onclick="location.reload()" 
          class="fancy-btn"
          style="margin-top: 1rem; margin-left: 1rem;"
        >üè† Home</button>
      </div>

      <!-- ‚úÖ Responsive Heading -->
      <h1 class="main-heading">
        üé® Image Compressor with Bulk Download
      </h1>

      <!-- Rest of your code continues untouched... -->
      <!-- ‚úÖ Your JS will work perfectly with IDs and classes as is -->


      <div class="flex justify-center gap-4 mb-6">
        <button id="easyTab" class="fancy-btn">üü¢ Easy Mode</button>
        <button id="advancedTab" class="fancy-btn bg-gray-700">‚öôÔ∏è Advanced Mode</button>
      </div>

      <div id="dropZone" class="drop-zone">
        üìÇ Drag & Drop Image(s) Here or <label for="fileInput" class="file-btn">üìÅ Choose File(s)</label>
        <input type="file" id="fileInput" accept="image/*" multiple>
      </div>
      <div class="flex justify-center mb-4">
      <button 
          id="addMoreBtn"
          class="fancy-btn bg-gray-700"
          type="button"
      >‚ûï Add More Files</button>
      </div>

      <p id="fileNameDisplay" class="text-center text-sm text-purple-300 mb-4 hidden">üìÑ Selected File: <span id="fileName"></span></p>
      <div id="bulkList" class="bulk-list"></div>

      <!-- Easy Mode -->
      <div id="easyMode" class="block text-center">
        <label>üéöÔ∏è Quality: <span id="easyQualityVal">70%</span></label>
        <input type="range" id="easyQuality" min="1" max="100" step="1" value="40" class="w-full">
        <p class="filter-instruction">Click the buttons below to preview and apply filters to your image.</p>
        <div class="filter-container">
          <button class="filter-btn" data-filter="none">None</button>
          <button class="filter-btn" data-filter="grayscale">Grayscale</button>
          <button class="filter-btn" data-filter="sepia">Sepia</button>
          <button class="filter-btn" data-filter="invert">Invert</button>
          <button class="filter-btn" data-filter="blur">Blur</button>
          <button class="filter-btn" data-filter="vintage">Vintage</button>
        </div>
        <div class="preview-container">
          <div>
            <div class="preview-label">üñºÔ∏è Original</div>
            <div id="easyOriginalPreview"></div>
          </div>
          <div>
            <div class="preview-label">üß† Compressed</div>
            <div id="easyCompressedPreview"></div>
          </div>
        </div>
        <div id="easyEstimate" class="text-sm text-gray-300 hidden"></div>
        <div id="easyAiMessage" class="text-sm font-semibold text-purple-400 hidden"></div>
        <button id="easyDownload" class="hidden fancy-btn">‚¨áÔ∏è Download</button>
      </div>

      <!-- Advanced Mode -->
      <div id="advancedMode" class="hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          <div>
            <label>üìè Width (px)</label>
            <input type="number" id="imgWidth" class="w-full">
          </div>
          <div>
            <label>üìê Height (px)</label>
            <input type="number" id="imgHeight" class="w-full">
          </div>
          <div>
            <label>üéöÔ∏è Quality: <span id="qualityValue">70%</span></label>
            <input type="range" id="qualityRange" min="1" max="100" step="1" value="40" class="w-full">
          </div>
        </div>
        <div>
          <label>üìÅ Format:</label>
          <select id="formatSelect" class="w-full">
            <option value="image/jpeg">JPEG (.jpg)</option>
            <option value="image/png">PNG (.png)</option>
            <option value="image/webp">WebP (.webp)</option>
            <option value="image/bmp">BMP (.bmp)</option>
            <option value="image/avif">AVIF (.avif)</option>
          </select>
        </div>
        <div>
          <label>üíæ Max File Size (KB):</label>
          <input type="number" id="maxSizeKB" placeholder="e.g. 200" class="w-full">
        </div>
        <div class="flex justify-center gap-4 my-2">
          <button id="toggleFilters" class="fancy-btn">Filters</button>
          <button id="toggleManual" class="fancy-btn bg-gray-700">Manual Edit</button>
        </div>
        <div id="filtersPanel">
          <p class="filter-instruction">Click the buttons below to preview and apply filters to your image.</p>
          <div class="filter-container" id="advancedFilterContainer">
            <button class="filter-btn" data-filter="none">None</button>
            <button class="filter-btn" data-filter="grayscale">Grayscale</button>
            <button class="filter-btn" data-filter="sepia">Sepia</button>
            <button class="filter-btn" data-filter="invert">Invert</button>
            <button class="filter-btn" data-filter="blur">Blur</button>
            <button class="filter-btn" data-filter="vintage">Vintage</button>
          </div>
          <div class="filter-slider-container" id="filterSliderContainer" style="display:none;">
            <span class="filter-slider-label" id="filterSliderLabel"></span>
            <input type="range" id="filterSlider" min="0" max="100" value="50" class="w-full">
            <span class="filter-slider-value" id="filterSliderValue"></span>
          </div>
        </div>
        <div id="manualPanel" style="display:none;">
          <p class="filter-instruction">Adjust the sliders below for manual editing.</p>
          <div class="space-y-2">
            <label>Brightness: <span id="brightnessVal">100</span>%</label>
            <input type="range" id="brightnessSlider" min="0" max="200" value="100" class="w-full">
            <label>Contrast: <span id="contrastVal">100</span>%</label>
            <input type="range" id="contrastSlider" min="0" max="200" value="100" class="w-full">
            <label>Grayscale: <span id="grayscaleVal">0</span>%</label>
            <input type="range" id="grayscaleSlider" min="0" max="100" value="0" class="w-full">
          </div>
        </div>
        <div id="estimate" class="text-sm text-gray-300 hidden"></div>
        <div id="aiMessage" class="text-sm font-semibold text-purple-400 hidden"></div>
        <div class="preview-container">
          <div>
            <div class="preview-label">üñºÔ∏è Original</div>
            <div id="originalPreview"></div>
          </div>
          <div>
            <div class="preview-label">üß† Compressed</div>
            <div id="compressedPreview"></div>
          </div>
        </div>
        <button id="downloadBtn" class="hidden fancy-btn">‚¨áÔ∏è Download</button>
      </div>
      <canvas id="canvas" class="hidden"></canvas>
    </div>
  </div>
  <script>
  const addMoreBtn = document.getElementById("addMoreBtn");
  const easyTab = document.getElementById("easyTab");
  const advancedTab = document.getElementById("advancedTab");
  const easyMode = document.getElementById("easyMode");
  const advancedMode = document.getElementById("advancedMode");
  const fileNameDisplay = document.getElementById("fileNameDisplay");
  const fileNameText = document.getElementById("fileName");
  const dropZone = document.getElementById("dropZone");
  const fileInput = document.getElementById("fileInput");
  const canvas = document.getElementById("canvas");
  const ctx = canvas.getContext("2d");
  const widthInput = document.getElementById("imgWidth");
  const heightInput = document.getElementById("imgHeight");
  const qualityRange = document.getElementById("qualityRange");
  const qualityValue = document.getElementById("qualityValue");
  const formatSelect = document.getElementById("formatSelect");
  const maxSizeInput = document.getElementById("maxSizeKB");
  const originalPreview = document.getElementById("originalPreview");
  const compressedPreview = document.getElementById("compressedPreview");
  const estimate = document.getElementById("estimate");
  const aiMessage = document.getElementById("aiMessage");
  const downloadBtn = document.getElementById("downloadBtn");
  const easyOriginalPreview = document.getElementById("easyOriginalPreview");
  const easyCompressedPreview = document.getElementById("easyCompressedPreview");
  const easyEstimate = document.getElementById("easyEstimate");
  const easyAiMessage = document.getElementById("easyAiMessage");
  const easyDownload = document.getElementById("easyDownload");
  const easyQuality = document.getElementById("easyQuality");
  const easyQualityVal = document.getElementById("easyQualityVal");
  const filterSliderContainer = document.getElementById("filterSliderContainer");
  const filterSlider = document.getElementById("filterSlider");
  const filterSliderLabel = document.getElementById("filterSliderLabel");
  const filterSliderValue = document.getElementById("filterSliderValue");
  const toggleFilters = document.getElementById("toggleFilters");
  const toggleManual = document.getElementById("toggleManual");
  const filtersPanel = document.getElementById("filtersPanel");
  const manualPanel = document.getElementById("manualPanel");
  const brightnessSlider = document.getElementById("brightnessSlider");
  const contrastSlider = document.getElementById("contrastSlider");
  const grayscaleSlider = document.getElementById("grayscaleSlider");
  const brightnessVal = document.getElementById("brightnessVal");
  const contrastVal = document.getElementById("contrastVal");
  const grayscaleVal = document.getElementById("grayscaleVal");
  const bulkList = document.getElementById("bulkList");

  let originalFile, originalImage;
  let isProcessing = false;
  let currentFilter = 'none';
  let filterButtons;
  let advancedFilterButtons;
  let currentFilterStrength = 50;
  let manualMode = false;
  let manualSettings = { brightness: 100, contrast: 100, grayscale: 0 };
  let bulkFiles = [];
  let activeFileIndex = 0;

  const filterSliderConfigs = {
    grayscale: { label: "Grayscale", min: 0, max: 100, value: 100, unit: "%" },
    sepia:    { label: "Sepia", min: 0, max: 100, value: 100, unit: "%" },
    invert:   { label: "Invert", min: 0, max: 100, value: 100, unit: "%" },
    blur:     { label: "Blur", min: 0, max: 20, value: 5, unit: "px" },
    vintage:  { label: "Vintage", min: 0, max: 100, value: 50, unit: "%" }
  };

  const themeToggle = document.getElementById('themeToggle');
  const html = document.documentElement;

  // Check for saved theme preference
  const savedTheme = localStorage.getItem('theme') || 'dark';
  html.setAttribute('data-theme', savedTheme);
  themeToggle.textContent = savedTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';

  // Theme toggle functionality
  themeToggle.addEventListener('click', () => {
    const currentTheme = html.getAttribute('data-theme');
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    
    html.setAttribute('data-theme', newTheme);
    themeToggle.textContent = newTheme === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    localStorage.setItem('theme', newTheme);
  });

  addMoreBtn.onclick = () => {
    fileInput.value = ""; // allow re-selecting same files
    fileInput.click();
  };

  easyTab.onclick = () => {
    easyMode.classList.remove("hidden");
    advancedMode.classList.add("hidden");
    easyTab.classList.replace("bg-gray-7", "bg-purple-600");
    advancedTab.classList.replace("bg-purple-600", "bg-gray-700");
    updateDownloadButtons();
  };
  advancedTab.onclick = () => {
    advancedMode.classList.remove("hidden");
    easyMode.classList.add("hidden");
    advancedTab.classList.replace("bg-gray-700", "bg-purple-600");
    easyTab.classList.replace("bg-purple-600", "bg-gray-700");
    updateDownloadButtons();
  };

  dropZone.addEventListener("dragover", e => {
    e.preventDefault(); 
    dropZone.classList.add("dragover");
  });
  dropZone.addEventListener("dragleave", () => {
    dropZone.classList.remove("dragover");
  });
  dropZone.addEventListener("drop", e => {
    e.preventDefault(); 
    dropZone.classList.remove("dragover");
    handleFiles(e.dataTransfer.files);
  });
  fileInput.addEventListener("change", () => handleFiles(fileInput.files));

  function handleFiles(files) {
    const newFiles = Array.from(files);
    // Only add files that are not already in bulkFiles (by name)
    newFiles.forEach(f => {
      if (!bulkFiles.some(existing => existing.name === f.name && existing.size === f.size)) {
        bulkFiles.push(f);
      }
    });
    if (bulkFiles.length === 0) return;
    if (bulkFiles.length === 1) {
      handleFile(bulkFiles[0]);
      bulkList.innerHTML = "";
    } else {
      activeFileIndex = 0;
      handleFile(bulkFiles[bulkFiles.length - 1]);
    }
    setTimeout(updateDownloadButtons, 300);
  }

  function handleFile(file) {
    if (!file) return;
    originalFile = file;
    fileNameDisplay.classList.remove("hidden");
    fileNameText.textContent = file.name;
    const reader = new FileReader();
    reader.onload = e => {
      const img = new Image();
      img.onload = () => {
        originalImage = img;
        widthInput.value = img.width;
        heightInput.value = img.height;
        originalPreview.innerHTML = `<img src="${e.target.result}">`;
        easyOriginalPreview.innerHTML = `<img src="${e.target.result}">`;
        compressNow();
        compressEasy();
      };
      img.src = e.target.result;
    };
    reader.readAsDataURL(file);
  }

  document.addEventListener('DOMContentLoaded', () => {
    filterButtons = document.querySelectorAll('.filter-container:not(#advancedFilterContainer) .filter-btn');
    filterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        filterButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        if (originalImage) compressEasy();
      });
    });
    advancedFilterButtons = document.querySelectorAll('#advancedFilterContainer .filter-btn');
    advancedFilterButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        advancedFilterButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentFilter = btn.dataset.filter;
        if (currentFilter !== 'none') {
          const cfg = filterSliderConfigs[currentFilter] || {label: "Strength", min: 0, max: 100, value: 50, unit: ""};
          filterSliderContainer.style.display = "";
          filterSliderLabel.textContent = cfg.label;
          filterSlider.min = cfg.min;
          filterSlider.max = cfg.max;
          filterSlider.value = cfg.value;
          filterSliderValue.textContent = cfg.value + cfg.unit;
          currentFilterStrength = cfg.value;
        } else {
          filterSliderContainer.style.display = "none";
        }
        if (originalImage && !manualMode) compressNow();
      });
    });
    filterSlider.addEventListener('input', () => {
      currentFilterStrength = filterSlider.value;
      const cfg = filterSliderConfigs[currentFilter] || {unit:""};
      filterSliderValue.textContent = filterSlider.value + cfg.unit;
      if (originalImage && !manualMode) compressNow();
    });
    [brightnessSlider, contrastSlider, grayscaleSlider].forEach(slider => {
      slider.addEventListener("input", () => {
        manualSettings.brightness = parseInt(brightnessSlider.value);
        manualSettings.contrast = parseInt(contrastSlider.value);
        manualSettings.grayscale = parseInt(grayscaleSlider.value);
        brightnessVal.textContent = manualSettings.brightness;
        contrastVal.textContent = manualSettings.contrast;
        grayscaleVal.textContent = manualSettings.grayscale;
        if (originalImage && manualMode) compressNow();
      });
    });
    toggleFilters.onclick = () => {
      manualMode = false;
      filtersPanel.style.display = "";
      manualPanel.style.display = "none";
      toggleFilters.classList.replace("bg-gray-700", "bg-purple-600");
      toggleManual.classList.replace("bg-purple-600", "bg-gray-700");
      if (originalImage) compressNow();
    };
    toggleManual.onclick = () => {
      manualMode = true;
      filtersPanel.style.display = "none";
      manualPanel.style.display = "";
      toggleManual.classList.replace("bg-gray-700", "bg-purple-600");
      toggleFilters.classList.replace("bg-purple-600", "bg-gray-700");
      if (originalImage) compressNow();
    };
  });

  // Set default quality display to 40%
  easyQualityVal.textContent = "40%";
  qualityValue.textContent = "40%";

  function applyFilter(imageData, filter, strength) {
    if (!filter || filter === "none") return imageData;
    const data = imageData.data;
    switch(filter) {
      case 'grayscale': {
        const s = (typeof strength === "undefined") ? 100 : parseInt(strength,10);
        for (let i = 0; i < data.length; i += 4) {
          const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
          data[i] = data[i] + (avg - data[i]) * (s/100);
          data[i+1] = data[i+1] + (avg - data[i+1]) * (s/100);
          data[i+2] = data[i+2] + (avg - data[i+2]) * (s/100);
        }
        break;
      }
      case 'sepia': {
        const s = (typeof strength === "undefined") ? 100 : parseInt(strength,10);
        for (let i = 0; i < data.length; i += 4) {
          const r = data[i], g = data[i+1], b = data[i+2];
          const tr = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
          const tg = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
          const tb = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
          data[i]   = r + (tr - r) * (s/100);
          data[i+1] = g + (tg - g) * (s/100);
          data[i+2] = b + (tb - b) * (s/100);
        }
        break;
      }
      case 'invert': {
        const s = (typeof strength === "undefined") ? 100 : parseInt(strength,10);
        for (let i = 0; i < data.length; i += 4) {
          data[i]   = data[i]   + ((255 - data[i])   - data[i])   * (s/100);
          data[i+1] = data[i+1] + ((255 - data[i+1]) - data[i+1]) * (s/100);
          data[i+2] = data[i+2] + ((255 - data[i+2]) - data[i+2]) * (s/100);
        }
        break;
      }
      case 'blur': {
        const blurAmount = (typeof strength === "undefined") ? 5 : parseInt(strength,10);
        const tempCanvas = document.createElement('canvas');
        const tempCtx = tempCanvas.getContext('2d');
        tempCanvas.width = imageData.width;
        tempCanvas.height = imageData.height;
        tempCtx.putImageData(imageData, 0, 0);
        tempCtx.filter = `blur(${blurAmount}px)`;
        tempCtx.drawImage(tempCanvas, 0, 0);
        return tempCtx.getImageData(0, 0, imageData.width, imageData.height);
      }
      case 'vintage': {
        const s = (typeof strength === "undefined") ? 50 : parseInt(strength,10);
        for (let i = 0; i < data.length; i += 4) {
          data[i]   = data[i]   * (1 - 0.1 * (s/100));
          data[i+1] = data[i+1] * (1 - 0.2 * (s/100));
          data[i+2] = data[i+2] * (1 - 0.5 * (s/100));
          data[i+3] = data[i+3] * (1 - 0.1 * (s/100));
        }
        break;
      }
      default:
        break;
    }
    return imageData;
  }
  function applyManualControls(imageData, settings) {
    const data = imageData.data;
    const b = settings.brightness / 100;
    const c = (259 * (settings.contrast + 255)) / (255 * (259 - settings.contrast));
    const g = settings.grayscale / 100;
    for (let i = 0; i < data.length; i += 4) {
      data[i] = Math.min(255, data[i] * b);
      data[i+1] = Math.min(255, data[i+1] * b);
      data[i+2] = Math.min(255, data[i+2] * b);
      data[i] = Math.min(255, Math.max(0, c * (data[i] - 128) + 128));
      data[i+1] = Math.min(255, Math.max(0, c * (data[i+1] - 128) + 128));
      data[i+2] = Math.min(255, Math.max(0, c * (data[i+2] - 128) + 128));
      if (g > 0) {
        const avg = (data[i] + data[i+1] + data[i+2]) / 3;
        data[i] = data[i] + (avg - data[i]) * g;
        data[i+1] = data[i+1] + (avg - data[i+1]) * g;
        data[i+2] = data[i+2] + (avg - data[i+2]) * g;
      }
    }
    return imageData;
  }

  [easyQuality, qualityRange, widthInput, heightInput, formatSelect, maxSizeInput].forEach(el => {
    el.addEventListener("input", () => {
      if (isProcessing) return;
      easyQualityVal.textContent = easyQuality.value + "%";
      qualityValue.textContent = qualityRange.value + "%";
      if (originalImage) {
        if (el === easyQuality) compressEasy();
        else compressNow();
      }
    });
  });

  const compressionOverlay = document.getElementById('compressionOverlay');
  const compressionAnimation = document.getElementById('compressionAnimation');

  function toggleCompressionAnimation(show) {
    if (show) {
      compressionOverlay.classList.add('active');
      compressionAnimation.classList.add('active');
    } else {
      compressionOverlay.classList.remove('active');
      compressionAnimation.classList.remove('active');
    }
  }

  function compressEasy() {
    if (!originalImage) return;
    isProcessing = true;
    toggleCompressionAnimation(true);
    
    canvas.width = originalImage.width;
    canvas.height = originalImage.height;
    ctx.drawImage(originalImage, 0, 0);
    if (currentFilter !== 'none') {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const filteredData = applyFilter(imageData, currentFilter, 100);
      ctx.putImageData(filteredData, 0, 0);
    }
    const quality = parseInt(easyQuality.value) / 100;
    canvas.toBlob(blob => {
      const url = URL.createObjectURL(blob);
      easyCompressedPreview.innerHTML = `<img src="${url}" />`;
      const originalKB = (originalFile.size / 1024).toFixed(2);
      const compressedKB = (blob.size / 1024).toFixed(2);
      const ratio = ((blob.size / originalFile.size) * 100).toFixed(1);
      easyEstimate.classList.remove("hidden");
      easyAiMessage.classList.remove("hidden");
      easyEstimate.innerHTML = `üì¶ Original: <b>${originalKB} KB</b><br>üìâ Compressed: <b>${compressedKB} KB</b><br>üìä Ratio: ${ratio}%`;
      easyAiMessage.textContent =
        quality < 0.3 ? "üò¨ Too blurry!" :
        quality < 0.7 ? "üëå Balanced!" :
        "üñºÔ∏è High Quality!";
      easyDownload.classList.remove("hidden");
      updateDownloadButtons();
      isProcessing = false;
      toggleCompressionAnimation(false);
    }, "image/jpeg", quality);
  }

  function compressNow() {
    if (!originalImage) return;
    isProcessing = true;
    toggleCompressionAnimation(true);
    
    const width = parseInt(widthInput.value) || originalImage.width;
    const height = parseInt(heightInput.value) || originalImage.height;
    const quality = parseInt(qualityRange.value) / 100;
    const format = formatSelect.value;
    const maxSizeKB = parseInt(maxSizeInput.value);
    canvas.width = width;
    canvas.height = height;
    ctx.drawImage(originalImage, 0, 0, width, height);
    if (manualMode) {
      let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      imageData = applyManualControls(imageData, manualSettings);
      ctx.putImageData(imageData, 0, 0);
    } else if (currentFilter !== 'none') {
      const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
      const filteredData = applyFilter(imageData, currentFilter, currentFilterStrength);
      ctx.putImageData(filteredData, 0, 0);
    }
    canvas.toBlob(blob => {
      let finalBlob = blob;
      let finalSizeKB = blob.size / 1024;
      let adjustedQuality = quality;
      let finalUrl = URL.createURL(finalBlob);
      let attempts = 0;
      const maxAttempts = 5;
      if (maxSizeKB && finalSizeKB > maxSizeKB && attempts < maxAttempts) {
        let newQuality = quality;
        while (finalSizeKB > maxSizeKB && attempts < maxAttempts) {
          newQuality = Math.max(0.1, newQuality - 0.1);
          canvas.toBlob(newBlob => {
            if (!newBlob) return;
            finalBlob = newBlob;
            finalSizeKB = newBlob.size / 1024;
            finalUrl = URL.createObjectURL(newBlob);
          }, format, newQuality);
          attempts++;
        }
      }
      compressedPreview.innerHTML = `<img src="${finalUrl}" />`;
      const originalKB = (originalFile.size / 1024).toFixed(2);
      const compressedKB = (finalBlob.size / 1024).toFixed(2);
      const ratio = ((finalBlob.size / originalFile.size) * 100).toFixed(1);
      estimate.classList.remove("hidden");
      aiMessage.classList.remove("hidden");
      estimate.innerHTML = `üì¶ Original: <b>${originalKB} KB</b><br>üìâ Compressed: <b>${compressedKB} KB</b><br>üìä Ratio: ${ratio}%`;
      aiMessage.textContent =
        adjustedQuality < 0.3 ? "üò¨ Too blurry!" :
        adjustedQuality < 0.7 ? "üëå Balanced!" :
        "üñºÔ∏è High Quality!";
      downloadBtn.classList.remove("hidden");
      updateDownloadButtons();
      isProcessing = false;
      toggleCompressionAnimation(false);
    }, format, quality);
  }

  // Add these variables at the beginning of your script
  const downloadOverlay = document.getElementById('downloadOverlay');
  const downloadAnimation = document.getElementById('downloadAnimation');

  // Add this function to show/hide download animation
  function toggleDownloadAnimation(show) {
    if (show) {
      downloadOverlay.classList.add('active');
      downloadAnimation.classList.add('active');
    } else {
      downloadOverlay.classList.remove('active');
      downloadAnimation.classList.remove('active');
    }
  }

  // Update the updateDownloadButtons function
  function updateDownloadButtons() {
    // Easy Mode
    if (bulkFiles.length > 1) {
      easyDownload.textContent = "‚¨áÔ∏è Bulk Download";
      easyDownload.onclick = () => {
        toggleDownloadAnimation(true);
        setTimeout(() => {
          bulkDownload('easy');
          setTimeout(() => toggleDownloadAnimation(false), 2000);
        }, 500);
      };
    } else {
      easyDownload.textContent = "‚¨áÔ∏è Download";
      easyDownload.onclick = () => {
        const img = easyCompressedPreview.querySelector('img');
        if (!img) return;
        toggleDownloadAnimation(true);
        setTimeout(() => {
          const link = document.createElement("a");
          link.href = img.src;
          link.download = `easy-compressed-${currentFilter}.jpg`;
          link.click();
          setTimeout(() => toggleDownloadAnimation(false), 2000);
        }, 500);
      };
    }
    // Advanced Mode
    if (bulkFiles.length > 1) {
      downloadBtn.textContent = "‚¨áÔ∏è Bulk Download";
      downloadBtn.onclick = () => {
        toggleDownloadAnimation(true);
        setTimeout(() => {
          bulkDownload('advanced');
          setTimeout(() => toggleDownloadAnimation(false), 2000);
        }, 500);
      };
    } else {
      downloadBtn.textContent = "‚¨áÔ∏è Download";
      downloadBtn.onclick = () => {
        const img = compressedPreview.querySelector('img');
        if (!img) return;
        toggleDownloadAnimation(true);
        setTimeout(() => {
          const link = document.createElement("a");
          link.href = img.src;
          link.download = `compressed-${currentFilter}.${(formatSelect.value||'image/jpeg').split('/')[1].replace('jpeg','jpg')}`;
          link.click();
          setTimeout(() => toggleDownloadAnimation(false), 2000);
        }, 500);
      };
    }
  }

  // Update the bulkDownload function
  function bulkDownload(mode) {
    if (bulkFiles.length < 2) return;
    const zip = new JSZip();
    function processFile(i) {
      if (i >= bulkFiles.length) {
        zip.generateAsync({type:"blob"}).then(function(content) {
          const a = document.createElement("a");
          a.href = URL.createObjectURL(content);
          a.download = "compressed-images.zip";
          a.click();
        });
        return;
      }
      const file = bulkFiles[i];
      const reader = new FileReader();
      reader.onload = e => {
        const img = new Image();
        img.onload = () => {
          let w = img.width, h = img.height, q = 0.7, format = "image/jpeg";
          if (mode === 'advanced') {
            w = parseInt(widthInput.value) || img.width;
            h = parseInt(heightInput.value) || img.height;
            q = parseInt(qualityRange.value) / 100;
            format = formatSelect.value;
          } else {
            q = parseInt(easyQuality.value) / 100;
          }
          canvas.width = w; canvas.height = h;
          ctx.drawImage(img, 0, 0, w, h);
          if (mode === 'advanced') {
            if (manualMode) {
              let imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
              imageData = applyManualControls(imageData, manualSettings);
              ctx.putImageData(imageData, 0, 0);
            } else if (currentFilter !== 'none') {
              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
              const filteredData = applyFilter(imageData, currentFilter, currentFilterStrength);
              ctx.putImageData(filteredData, 0, 0);
            }
          } else {
            if (currentFilter !== 'none') {
              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
              const filteredData = applyFilter(imageData, currentFilter, 100);
              ctx.putImageData(filteredData, 0, 0);
            }
          }
          canvas.toBlob(blob => {
            zip.file(file.name.replace(/\.[^.]+$/, ".jpg"), blob);
            processFile(i+1);
          }, "image/jpeg", q);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
    processFile(0);
  }

  function renderBulkList() {
    if (bulkFiles.length <= 1) {
      bulkList.innerHTML = "";
      return;
    }
    bulkList.innerHTML = bulkFiles.map((f, idx) => {
      const url = URL.createObjectURL(f);
      return `<span style="display:inline-block;position:relative;margin:0 8px 8px 0;">
        <img src="${url}" style="width:60px;height:60px;object-fit:cover;border-radius:8px;border:2px solid #a78bfa;box-shadow:0 2px 8px #0002;vertical-align:middle;">
        <button onclick="deleteBulkFile(${idx})" style="position:absolute;top:-8px;right:-8px;background:#f472b6;border:none;border-radius:50%;width:22px;height:22px;color:#fff;font-weight:bold;cursor:pointer;box-shadow:0 1px 4px #0003;">‚úñ</button>
        <div style='font-size:11px;color:#a78bfa;text-align:center;max-width:60px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;'>${f.name}</div>
      </span>`;
    }).join("");
  }

  function deleteBulkFile(idx) {
    // Remove file and update previews
    const wasCurrent = (bulkFiles[idx] === originalFile);
    bulkFiles.splice(idx, 1);
    if (bulkFiles.length === 0) {
      originalFile = null;
      originalImage = null;
      fileNameDisplay.classList.add("hidden");
      originalPreview.innerHTML = "";
      compressedPreview.innerHTML = "";
      easyOriginalPreview.innerHTML = "";
      easyCompressedPreview.innerHTML = "";
      easyEstimate.classList.add("hidden");
      easyAiMessage.classList.add("hidden");
      estimate.classList.add("hidden");
      aiMessage.classList.add("hidden");
      easyDownload.classList.add("hidden");
      downloadBtn.classList.add("hidden");
    } else {
      // If deleted file was current, show next or previous
      let nextIdx = idx;
      if (nextIdx >= bulkFiles.length) nextIdx = bulkFiles.length - 1;
      handleFile(bulkFiles[nextIdx]);
    }
    renderBulkList();
    updateDownloadButtons();
  }

  // Patch handleFiles to call renderBulkList
  function handleFiles(files) {
    const newFiles = Array.from(files);
    newFiles.forEach(f => {
      if (!bulkFiles.some(existing => existing.name === f.name && existing.size === f.size)) {
        bulkFiles.push(f);
      }
    });
    if (bulkFiles.length === 0) return;
    if (bulkFiles.length === 1) {
      handleFile(bulkFiles[0]);
      bulkList.innerHTML = "";
    } else {
      activeFileIndex = 0;
      handleFile(bulkFiles[bulkFiles.length - 1]);
      renderBulkList();
    }
    setTimeout(updateDownloadButtons, 300);
  }
  </script>
  <!-- Add this just before </body> -->
  <div class="signature-container">
    <span class="signature-text">&mdash; made with <span class="signature-heart">‚ù§</span> by <span class="signature-highlight">shibbux</span></span>
  </div>
  <link href="https://fonts.googleapis.com/css?family=Pacifico|Dancing+Script&display=swap" rel="stylesheet">
  <style>
    .signature-text {
      font-family: 'Pacifico', 'Dancing Script', cursive, sans-serif;
      font-size: 2rem;
      color: #fff;
      background: none;
      -webkit-background-clip: initial;
      background-clip: initial;
      -webkit-text-fill-color: initial;
      text-shadow: 2px 2px 8px #00000033;
      letter-spacing: 2px;
      user-select: none;
      display: inline-block;
      padding-right: 0.5rem;
    }
    .signature-highlight {
      color: #fff;
      background: none;
      -webkit-text-fill-color: #fff;
    }
    .signature-heart {
      color: #ff4d6d;
      font-size: 1.2em;
      vertical-align: middle;
      margin: 0 0.2em;
    }
    @media (max-width: 640px) {
      .signature-text {
        font-size: 1.2rem;
        padding-right: 0.2rem;
      }
    }
  </style>
  <!-- End signature -->
</body>
</html>
